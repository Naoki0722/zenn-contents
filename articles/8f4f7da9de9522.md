---
title: "Next.jsã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§react-hook-formã‚’åˆ©ç”¨ã—ãŸè©±"
emoji: "ğŸŒŠ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["React", "ReactHookForm", "TypeScript"]
published: true
---

Next.js ã‚’è§¦ã£ã¦ã„ã‚‹æ™‚ã«ã€ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆã—ã¦ã„ã¾ã—ãŸã€‚

ç§ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®äººé–“ãªã®ã§ã€Next.js ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‘¨ã‚Šã«é–¢ã—ã¦ã©ã†ã™ã‚Œã°ã„ã„ã®ã‹æ‚©ã‚“ã§ã„ã¾ã—ãŸã€‚

ã©ã†ã‚„ã‚‰ `react-hook-form` ã¨ã„ã†ã‚‚ã®ãŒã‚ã‚‹ã‚‰ã—ãã€ä»Šå›ãã‚Œã‚’ç”¨ã„ã¦ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

ä½¿ã£ã¦ã¿ãŸã‚‰ã€ã¨ã¦ã‚‚ç°¡å˜ã§ã—ãŸã€‚

## react-hook-form ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

yarn or npm ã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
yarn add react-hook-form

or

npm install react-hook-form
```

## ä½¿ã„æ–¹

å¤§ä½“ã®ã“ã¨ã¯ä¸‹è¨˜ãƒšãƒ¼ã‚¸ã‚’è¦‹ã‚‹ã¨å®Ÿè£…ã§ãã¡ã‚ƒã„ã¾ã™ã€‚

https://react-hook-form.com/jp/get-started/#Quickstart

ã¤ã¾ã‚Šã€useForm ã‚’åˆ©ç”¨ã—ã€submit æ™‚ã« handleSubmit ã‚’å‘¼ã³å‡ºã—ã€å¼•æ•°ã«å®Ÿè¡Œã—ãŸã„é–¢æ•°ã‚’æŒ‡å®šã—ã¾ã™ã€‚

### register()ã«ã¤ã„ã¦

ã¡ã‚‡ã£ã¨ã°ã‹ã‚Šå¥‡å¦™ãªæ§‹æ–‡ãŒ..ã€‚

```TypeScript
<input defaultValue="test" {...register("example")} />

<input {...register("exampleRequired", { required: true })} />
```

ã“ã® register ã¯ä¸€ä½“ä½•ã‚’ã—ã¦ã„ã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚


ã¾ãšã¯ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã‚‹ã€‚

https://react-hook-form.com/api/useform/register/

ãã®ã‚ã¨ã¯ã€ `node_modules/react-hook-form/dist/types/form.d.ts` ã®ä¸­ã‚’è¦‹ã¾ã™ã€‚

````ts
/**
 * Register field into hook form with or without the actual DOM ref. You can invoke register anywhere in the component including at `useEffect`.
 *
 * @remarks
 * [API](https://react-hook-form.com/api/useform/register) â€¢ [Demo](https://codesandbox.io/s/react-hook-form-register-ts-ip2j3) â€¢ [Video](https://www.youtube.com/watch?v=JFIpCoajYkA)
 *
 * @param name - the path name to the form field value, name is required and unique
 * @param options - register options include validation, disabled, unregister, value as and dependent validation
 *
 * @returns onChange, onBlur, name, ref, and native contribute attribute if browser validation is enabled.
 *
 * @example
 * ```tsx
 * // Register HTML native input
 * <input {...register("input")} />
 * <select {...register("select")} />
 *
 * // Register options
 * <textarea {...register("textarea", { required: "This is required.", maxLength: 20 })} />
 * <input type="number" {...register("name2", { valueAsNumber: true })} />
 * <input {...register("name3", { deps: ["name2"] })} />
 *
 * // Register custom field at useEffect
 * useEffect(() => {
 *   register("name4");
 *   register("name5", { value: '"hiddenValue" });
 * }, [register])
 *
 * // Register without ref
 * const { onChange, onBlur, name } = register("name6")
 * <input onChange={onChange} onBlur={onBlur} name={name} />
 * ```
 */
export declare type UseFormRegister<TFieldValues extends FieldValues> = <
  TFieldName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>
>(
  name: TFieldName,
  options?: RegisterOptions<TFieldValues, TFieldName>
) => UseFormRegisterReturn;
````

ã¤ã¾ã‚Šã€register é–¢æ•°ã§ã¯ name ã¨ RegisterOptions ã‚’å¼•æ•°ã«ã¨ã£ã¦ã€submit æ™‚ã« JSON å½¢å¼ã§å€¤ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã§ã™ã€‚

ãã—ã¦ã€useEffect ã«ã‚‚çµ„ã¿è¾¼ã‚€ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã€‚

å…¬å¼ã§ã¯ã€ä¸‹è¨˜ï¼’ã¤ã®ã‚³ãƒ¼ãƒ‰ã¯åŒã˜æ„å‘³ã§ã‚ã‚‹ã¨æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚

```ts
const { onChange, onBlur, name, ref } = register("firstName");
// include type check against field path with the name you have supplied.

<input
  onChange={onChange} // assign onChange event
  onBlur={onBlur} // assign onBlur event
  name={name} // assign name prop
  ref={ref} // assign ref prop
/>;
```


```ts
<input {...register("firstName")} />
```


RegisterOptions ã§ã™ãŒã€ä¸‹è¨˜ã®ã‚ˆã†ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æº–å‚™ã—ã¦ãã‚Œã¦ã„ã¾ã™ã€‚

pattern ãŒã‚ã£ã¦æ­£è¦è¡¨ç¾ã‚‚å¯¾å¿œã—ã¦ã„ã‚‹ã®ã§ã€å¤§ä½“ã®ãƒ•ã‚©ãƒ¼ãƒ ã«ã¯å¯¾å¿œã§ãã‚‹ã‹ã¨ã€‚

- required
- maxLength
- minLength
- max
- min
- pattern
- validate
- valueAsNumber
- valueAsDate
- setValueAs
- disabled
- onChange
- onBlur
- value
- shouldUnregister
- deps

### watch

watch ã¯ã€å„å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã®ç›£è¦–ãŒå¯èƒ½ã§ã™ã€‚

ä¾‹ãˆã°ã€useEffect ã« watch ã‚’ç›£è¦–ã•ã›ã¦ãŠã‘ã°ã€å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã«å¤‰æ›´ãŒã‚ã‚‹éš›ã«ã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’èµ°ã‚‰ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã¾ã™ã€‚

https://react-hook-form.com/api/useform/watch

### formState

ãƒ•ã‚©ãƒ¼ãƒ çŠ¶æ…‹ã«ã¤ã„ã¦å…¨ä½“ã«é–¢ã™ã‚‹æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

ãŸã ã€åˆ©ç”¨ã™ã‚‹éš›ã¯äº‹å‰ã«å±•é–‹ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚

```JS
// âŒ formState.isValid is accessed conditionally,
// so the Proxy does not subscribe to changes of that state
return <button disabled={!formState.isDirty || !formState.isValid} />;

// âœ… read all formState values to subscribe to changes
const { isDirty, isValid } = formState;
return <button disabled={!isDirty || !isValid} />;
```

### handleSubmit

ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›å€¤ã®æ¤œè¨¼ãŒå•é¡ŒãªãæˆåŠŸã—ãŸã‚‰ã€ã“ã®é–¢æ•°ã§ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹ãŸã‚ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã¨ãªã£ã¦ã„ã¾ã™ã€‚

ä¸€æ–¹ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸæ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚‚ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

```ts
// æˆåŠŸæ™‚
SubmitHandler	(data: Object, e?: Event) => void

// å¤±æ•—æ™‚
SubmitErrorHandler	(errors: Object, e?: Event) => void
```

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŒ–ã«ãŠã‘ã‚‹å•é¡Œç‚¹ã®è§£æ±º

ã—ã‹ã—ã€ä¸Šè¨˜ã®å®Ÿè£…ã¨ãªã‚‹ã¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŒ–ãŒé›£ã—ããªã‚Šã¾ã™ã€‚

ãã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã€2 ã¤ã®æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

1. è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰å­ã« register é–¢æ•°ã‚’æ¸¡ã—ã¦ç™»éŒ²ã™ã‚‹æ–¹æ³•
1. ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã« ref ã‚’ä¸ãˆã¦ç®¡ç†ã™ã‚‹æ–¹æ³•

### è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰å­ã« register é–¢æ•°ã‚’æ¸¡ã—ã¦ç™»éŒ²ã™ã‚‹æ–¹æ³•

è¦ªãƒ•ã‚¡ã‚¤ãƒ«ã€‚

```ts
import React from "react";
import { useForm, SubmitHandler } from "react-hook-form";
import { Input } from "./Input";
import { Select } from "./Select";
import "./styles.css";

export interface IFormValues {
  "First Name": string;
  Age: number;
}
function App() {
  const { register, handleSubmit } = useForm<IFormValues>();
  const onSubmit: SubmitHandler<IFormValues> = (data) => {
    alert(JSON.stringify(data));
  };
  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <Input label="First Name" register={register} required />
      <Select label="Age" {...register("Age")} />
      <input type="submit" />
    </form>
  );
}

export default App;
```

Input ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã« props ã¨ã—ã¦ã€ `label`ã€`register`ã€`required`ã‚’æ¸¡ã—ã¦ã„ã¾ã™ã€‚

```ts
<Input label="First Name" register={register} required />
```

å­ãƒ•ã‚¡ã‚¤ãƒ«ã€‚

Input.tsx

```ts
import { Path, UseFormRegister } from "react-hook-form";
import { IFormValues } from "./App";

type InputProps = {
  label: Path<IFormValues>;
  register: UseFormRegister<IFormValues>;
  required: boolean;
};
// <input>è¦ç´ ã‚’å«ã‚“ã å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
export const Input = ({ label, register, required }: InputProps) => (
  <label>
    {label}
    <input {...register(label, { required })} />
  </label>
);
```

ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã« ref ã‚’ä¸ãˆã¦ç®¡ç†ã™ã‚‹æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚

ãŸã ã—ã€React ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚‚è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒã€ref ã‚’å­ã«æ¸¡ã™ã“ã¨ãŒã§ããšã€åˆ©ç”¨ã‚‚ã§ãã¾ã›ã‚“ã€‚

> é€šå¸¸ã®é–¢æ•°ã¾ãŸã¯ã‚¯ãƒ©ã‚¹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ ref å¼•æ•°ã‚’å—ã‘å–ã‚‰ãšã€ref ã¯ props ã‹ã‚‰ã‚‚åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚

è¦ªãŒä¸ãˆãŸ `ref` ã‚’å—ã‘å–ã‚‹ãŸã‚ã«ç”¨ã„ã‚‹ã®ãŒ `React.forwardRef` ã§ã™ã€‚

å­ãƒ•ã‚¡ã‚¤ãƒ«ã€‚

Select.tsx

```ts
import React from "react";
import { UseFormRegister } from "react-hook-form";
import { IFormValues } from "./App";

// React.forwardRefã‚’åˆ©ç”¨ã—ã€refã‚’æ¸¡ã™
export const Select = React.forwardRef<
  HTMLSelectElement,
  { label: string } & ReturnType<UseFormRegister<IFormValues>>
>(({ onChange, onBlur, name, label }, ref) => (
  <label>
    {label}
    <select name={name} ref={ref} onChange={onChange} onBlur={onBlur}>
      <option value="20">20</option>
      <option value="30">30</option>
    </select>
  </label>
));
```

`ref`ã‚’ä½¿ã†ã“ã¨ã§ Select.tsx ã® DOM ãŒ`selectã‚¿ã‚°`ã§ã‚ã‚‹ã“ã¨ã‚’èªè­˜ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

register é–¢æ•°ã«ã¯ã€`onChange`ã€`onBlur`ã€`ref`ã€`name`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿”ã—ã¾ã™ã€‚

ãªã®ã§ã€è¦ªã‹ã‚‰`{...register("Age")}`ã¨æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€name ã‚„ ref ãªã©ãŒå­ã§åˆ©ç”¨ã§ãã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚

â€»ãã‚‚ãã‚‚ã€React ã«ãŠã‘ã‚‹ ref ã¨ã„ã†ã®ã¯ã€ã¡ã‚‡ã£ã¨é›£ã—ã„ã¨ã“ã‚ãªã®ã§åˆ¥é€”è§£èª¬ã™ã‚‹äºˆå®šã§ã™ã€‚

## ã¾ã¨ã‚

react-hook-form ã¯æ±ç”¨æ€§ãŒé«˜ãã€æ—¢å­˜ã®çµ„ã¿è¾¼ã¾ã‚ŒãŸ UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«å¯¾ã—ã¦ã‚‚ã€useController ã‚’ä½¿ã†ã“ã¨ã§æ¯”è¼ƒçš„ç°¡å˜ã«å°å…¥ã§ãã¾ã™ã€‚

ãƒ•ãƒ­ãƒ³ãƒˆå´ã§æœ€ä½é™ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã€UX å‘ä¸Šã‚’å›³ã‚‹ã®ã¯ã¨ã¦ã‚‚å¤§åˆ‡ãªã“ã¨ãªã®ã§ã€ç©æ¥µçš„ã«å°å…¥ã§ããŸã‚‰ã¨æ€ã„ã¾ã—ãŸã€‚

## ä»Šå›å‚è€ƒã«ã—ãŸè¨˜äº‹

https://react-hook-form.com/jp/get-started

https://react-hook-form.com/api

(ä¸‹è¨˜ã¯ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ç´°ã‹ãåˆ†ã‘ã‚‰ã‚Œã¦ã„ã¦ã€ã¨ã¦ã‚‚å‹‰å¼·ã«ãªã‚Šã¾ã—ãŸ)
https://qiita.com/FumioNonaka/items/943909dee793ee63416b
